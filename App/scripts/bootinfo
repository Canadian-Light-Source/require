#!/bin/sh
#File: 		bootinfo
#Description: 	get info from the IOC_LASTBOOTED database table
#Author:	D.Zimoch
#Parameters:    

function help() {
    echo "usage: bootinfo [options] [pattern]"
    echo "  Find boot information about %pattern% in database"
    echo "options are:"
    echo "  -h, -?, --help : print this help and quit"
    echo "  -v, --version  : print cvs version info and quit"
    echo "  -- : treat next word as pattern, even if starting with -"
    exit 0
}

function version() {
    echo 'Author: D. Zimoch'
    echo '$Date: 2004/08/02 09:05:46 $'
    echo '$Source: /cvs/G/DRV/misc/App/scripts/bootinfo,v $'
    exit 0
}

while true
do
  case "$1" in
    -*h* | -*\?* | --help) help ;;
    -*v* | --version) version ;;
    --) shift; break ;;
    -*) echo "Unknown option $1. Try: --help"
        exit 1 ;;
    *)  break ;;
  esac
  shift
done

if [ -d /usr/oracle-9.2 ] ; then
        export ORACLE_HOME=/usr/oracle-9.2
else
        export ORACLE_HOME=/usr/oracle-8.1.7
	export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
fi

$ORACLE_HOME/bin/sqlplus -s ssrm_public/pub01@psip0 << EOF
SET PAGESIZE 10000;
SET LINESIZE 1000;
SET FEEDBACK OFF;

COLUMN IOC FORMAT A17;
COLUMN SLSBASE FORMAT A7;
COLUMN EPICS FORMAT A7;
COLUMN VXWORKS FORMAT A7;
COLUMN ARCH FORMAT A15;

SELECT SYSTEM AS IOC,
       BOOTDATE,
       BOOTTIME,
       BOOTPC,
       SLSBASE,
       EPICSVER AS EPICS,
       VXWORKSVER AS VXWORKS,
       IPADDR,
       SUBSTR(VXWORKS,INSTR(VXWORKS,'/',-1,2)+1,
            INSTR(VXWORKS,'/',-1,1)-INSTR(VXWORKS,'/',-1,2)-1) AS ARCH
FROM SSRM.IOC_LASTBOOTED
WHERE  SYSTEM     LIKE '%$1%' OR
       BOOTPC     LIKE '%$1%' OR
       SLSBASE    LIKE '%$1%' OR
       EPICSVER   LIKE '%$1%' OR
       VXWORKSVER LIKE '%$1%' OR
       ETHADDR    LIKE '%$1%' OR
       IPADDR     LIKE '%$1%' OR
       VXWORKS    LIKE '%$1%'
ORDER BY 1;

EXIT
EOF
# $Name:  $
# $Id: bootinfo,v 1.11 2004/08/02 09:05:46 zimoch Exp $
# $Source: /cvs/G/DRV/misc/App/scripts/bootinfo,v $
# $Revision: 1.11 $

