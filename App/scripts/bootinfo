#!/bin/sh
#File: 		bootinfo
#Description: 	get info from the IOC_LASTBOOTED database table
#Author:	D.Zimoch
#Parameters:    

function help() {
    echo "usage: bootinfo [options] [pattern]"
    echo "  Find boot information about %pattern% in database"
    echo "  pattern is matched against IOC,IP_ADDRESS,BOOTPC,PORTSV,LOCATION,SWITCH"
    echo "options are:"
    echo "  -h, -?, --help : print this help and quit"
    echo "  -v, --version  : print cvs version info and quit"
    echo "  -i : print IP_ADDRESS"
    echo "  -l : print LOCATION"
    echo "  -b : print BOOTPC and BOOTPC_IP_ADDR"
    echo "  -p : print PORTSERVER (server and port)"
    echo "  -s : print SAVERESTORE (server and if restore should be used)"
    echo "  -n : print network SWITCH"
    echo "  -a : print all (= -ilbpsn)"
    echo "  -- : treat next word as pattern, even if starting with -"
    echo "default options are: -ibl"
    exit 0
}

function version() {
    echo 'Author: D. Zimoch'
    echo '$Date: 2004/08/02 09:02:38 $'
    echo '$Source: /cvs/G/DRV/misc/App/scripts/bootinfo,v $'
    exit 0
}

while true
do
case "$1" in
    -*h* | -*\?* | --help) help ;;
    -*v* | --version) version ;;
    --) shift; break ;;
    -*) OPTION=$1
        while true
        do
        OPTION=${OPTION:1}
        case "$OPTION" in
            i*) SEL="$SEL,IP_ADDRESS" ;;
            l*) SEL="$SEL,LOCATION" ;;
            b*) SEL="$SEL,BOOTPC,BOOTPC_IP_ADDR" ;;
            p*) SEL="$SEL,PORTSERVER" ;;
            s*) SEL="$SEL,SAVERESTORE" ;;
            n*) SEL="$SEL,SWITCH" ;;
            a*) SEL="$SEL,IP_ADDRESS,LOCATION,BOOTPC,BOOTPC_IP_ADDR,PORTSERVER,SAVERESTORE,SWITCH" ;;
            "") break ;;
            *)  echo "Unknown option -${OPTION:0:1}. Try: --help"
                exit 1 ;;
        esac
        done  ;;
    *)  break;;
esac
shift
done

if [ -d /usr/oracle-9.2 ] ; then
        export ORACLE_HOME=/usr/oracle-9.2
else
        export ORACLE_HOME=/usr/oracle-8.1.7
	export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
fi

$ORACLE_HOME/bin/sqlplus -s ssrm_public/pub01@psip0 << EOF
SET PAGESIZE 10000;
SET LINESIZE 1000;
SET FEEDBACK OFF;

COLUMN IOC FORMAT A17;
COLUMN SLSBASE FORMAT A7;
COLUMN EPICS FORMAT A7;
COLUMN VXWORKS FORMAT A7;
COLUMN ARCH FORMAT A15;

SELECT SYSTEM AS IOC,
       BOOTDATE,
       BOOTTIME,
       BOOTPC,
       SLSBASE,
       EPICSVER AS EPICS,
       VXWORKSVER AS VXWORKS,
       IPADDR,
       SUBSTR(VXWORKS,INSTR(VXWORKS,'/',-1,2)+1,
            INSTR(VXWORKS,'/',-1,1)-INSTR(VXWORKS,'/',-1,2)-1) AS ARCH
FROM SSRM.IOC_LASTBOOTED
WHERE  SYSTEM     LIKE '%$1%' OR
       BOOTPC     LIKE '%$1%' OR
       SLSBASE    LIKE '%$1%' OR
       EPICSVER   LIKE '%$1%' OR
       VXWORKSVER LIKE '%$1%' OR
       ETHADDR    LIKE '%$1%' OR
       IPADDR     LIKE '%$1%' OR
       VXWORKS    LIKE '%$1%'
ORDER BY 1;

EXIT
EOF
# $Name:  $
# $Id: bootinfo,v 1.10 2004/08/02 09:02:38 zimoch Exp $
# $Source: /cvs/G/DRV/misc/App/scripts/bootinfo,v $
# $Revision: 1.10 $

